<section class="card">
  <div class="max-w-5xl mx-auto space-y-12">
    <section class="grid md:grid-cols-2 gap-8">
      @if(product()?.imageBase64?.length){
      <img [src]="product()?.imageBase64?.[0]" class="h-60 w-full object-cover rounded-lg mb-4" />
      } @else {
      <img
        src="./../../../../assets/images/placeholder_product_dark.svg"
        alt="No image"
        class="h-60 w-full object-cover rounded-lg mb-4"
      />
      }
      <div>
        <h1 class="text-3xl font-bold text-tertiary mb-2">
          {{ product()?.productName }}
        </h1>
        <h1 class="text-xl font-bold text-tertiary mb-2">
          {{ product()?.productSummary }}
        </h1>
        <p class="text-lg leading-relaxed mb-4">
          {{ product()?.editorReview }}
        </p>
      </div>
    </section>

    <section class="grid sm:grid-cols-2 gap-4">
      <div class="bg-beige-lighter p-3 shadow-amber-950 shadow-lg rounded-xl text-center">
        <p class="text-slate-500 text-sm">Editor Score</p>
        <p class="text-3xl font-bold text-sky-400">{{ product()?.editorRating }} ‚òÖ</p>
      </div>

      <div class="bg-beige-darker p-3 shadow-amber-950 shadow-lg rounded-xl text-center">
        <p class="text-slate-400 text-sm">User Score</p>
        <p class="text-3xl font-bold text-yellow-400">{{ userScore() }} ‚òÖ</p>
      </div>
    </section>
    <div class="relative inline-block text-left">
      <button
        type="button"
        (click)="isOpen.set(!isOpen())"
        class="shadow-amber-950 shadow-lg rounded-xl flex items-center gap-2 px-4 py-2 bg-tertiary text-slate-300 hover:bg-slate-700 hover:text-white transition"
      >
        Sort: {{ sortLabel() }}
        <span class="text-xl">‚ñæ</span>
      </button>

      <div
        *ngIf="isOpen()"
        class="absolute right-0 mt-2 w-45 rounded-lg bg-slate-900 border border-slate-800 shadow-lg z-10"
      >
        <button
          class="dropdown-item"
          [class.active]="sortBy() === 'recent'"
          (click)="sortBy.set('recent'); isOpen.set(false)"
        >
          Most Recent
        </button>

        <button
          class="dropdown-item"
          [class.active]="sortBy() === 'longest'"
          (click)="sortBy.set('longest'); isOpen.set(false)"
        >
          Longest Use
        </button>

        <button
          class="dropdown-item"
          [class.active]="sortBy() === 'helpful'"
          (click)="sortBy.set('helpful'); isOpen.set(false)"
        >
          Most Helpful
        </button>
      </div>
    </div>

    <section class="space-y-6">
      <div
        *ngFor="let exp of sortedExperiences()"
        class="bg-slate-500 p-5 shadow-amber-950 shadow-xl rounded-xl"
      >
        <div class="flex justify-between mb-1">
          <span class="text-slate-100 font-medium">{{ exp.user }}</span>
          <span class="text-yellow-400">{{ exp.rating }} ‚òÖ</span>
        </div>

        <p class="text-slate-300 mb-3">
          {{ exp.comment }}
        </p>

        <div class="flex justify-between items-center text-sm text-slate-950">
          <span>Used for {{ exp.monthsUsed }} months</span>

          <div class="flex gap-4">
            <button class="hover:text-green-400" (click)="vote(exp.id, 'helpful')">
              üëç Helpful ({{ exp.helpful }})
            </button>
            <button class="hover:text-red-400" (click)="vote(exp.id, 'notHelpful')">
              üëé Not Helpful ({{ exp.notHelpful }})
            </button>
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2 class="text-xl font-semibold text-tertiary mb-4">Share Your Experience</h2>

      <form
        class="p-6 space-y-4 bg-secondary-50 shadow-amber-950 shadow-2xl rounded-xl"
        (ngSubmit)="submitExperience()"
      >
        <input
          [(ngModel)]="newExperience.user"
          name="user"
          required
          placeholder="Your name"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500"
        />

        <textarea
          [(ngModel)]="newExperience.comment"
          name="comment"
          required
          placeholder="Your real-world experience"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500"
        ></textarea>

        <input
          type="number"
          min="1"
          [(ngModel)]="newExperience.monthsUsed"
          name="monthsUsed"
          placeholder="Months used"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500"
        />
        <input
          type="number"
          min="1"
          [(ngModel)]="newExperience.rating"
          name="rating"
          placeholder="Your rating"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500"
        />

        <div class="flex justify-end">
          <button
            class="bg-tertiary enabled:hover:bg-sky-600 text-slate-100 font-semibold rounded-lg px-6 py-3 transition disabled:opacity-50 disabled:cursor-not-allowed max-md:w-full"
          >
            Submit Experience
          </button>
        </div>
      </form>
    </section>
  </div>
</section>
