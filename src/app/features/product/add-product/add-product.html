<section class="card">
  <div class="max-w-5xl mx-auto space-y-12">
    <button
      appBack
      fallbackRoute="/"
      class="fixed top-[80px] z-[99] inline-flex items-center justify-center gap-1 px-2 py-1 mt-0.5 rounded-lg bg-white/90 backdrop-blur-md shadow-xl hover:scale-105 active:scale-95 transition cursor-pointer animate-pulse"
    >
      <span class="text-lg font-bold leading-none flex items-center justify-center"> ← </span>

      <span class="text-base font-bold leading-none flex items-center justify-center pr-2">
        Back
      </span>
    </button>
    <h1 class="text-3xl font-bold mb-6 text-shadow-lg">Add New Product</h1>

    <form
      [formGroup]="addProductForm"
      (ngSubmit)="onSubmit()"
      class="space-y-6 bg-secondary-50 shadow-amber-950 shadow-2xl rounded-xl p-8"
    >
      <div>
        <label class="block text-tertiary font-medium mb-1">
          Category <span class="text-red-500">*</span>
        </label>

        <select
          formControlName="category"
          (change)="onCategoryChange($any($event.target).value)"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary focus:outline-none focus:ring-2 focus:ring-sky-500 cursor-pointer"
        >
          <option value="">Select category</option>

          @for (cat of categories; track cat.slug) {
            <option [value]="cat.slug">{{ cat.name }}</option>
          }
        </select>
      </div>
      <div>
        <label class="block text-tertiary font-medium mb-1">
          Subcategory <span class="text-red-500">*</span>
        </label>

        <select
          formControlName="subcategory"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary focus:outline-none focus:ring-2 focus:ring-sky-500 disabled:bg-slate-50 disabled:cursor-not-allowed cursor-pointer"
        >
          <option value="">Select subcategory</option>

          @for (sub of selectedSubcategories(); track sub.slug) {
            <option [value]="sub.slug">{{ sub.name }}</option>
          }
        </select>
      </div>
      <div>
        <label class="block text-tertiary font-medium mb-1">
          Product Name <span class="text-red-500">*</span></label
        >
        <input
          formControlName="productName"
          placeholder="e.g. iPhone 17 Pro"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500 placeholder:text-sm"
        />
      </div>
      <div>
        <label class="block text-tertiary font-medium mb-1">
          Product Summary <span class="text-red-500">*</span></label
        >
        <textarea
          formControlName="productSummary"
          rows="2"
          placeholder="Product overview"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500 placeholder:text-sm"
        ></textarea>
      </div>
      <div>
        <label class="block text-tertiary font-medium mb-1">
          Editor Review <span class="text-red-500">*</span></label
        >
        <textarea
          formControlName="editorReview"
          rows="4"
          placeholder="Detailed hands-on editor review"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500 placeholder:text-sm"
        ></textarea>
      </div>
      <!-- <div>
        <label class="block text-tertiary font-medium mb-1">
          Editor Rating <span class="text-red-500">*</span></label
        >
        <input
          type="number"
          min="1"
          max="5"
          step="0.1"
          formControlName="editorRating"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500"
        />
      </div> -->
      <div>
        <label class="block text-tertiary font-medium mb-1"
          >Editor Rating <span class="text-red-500">*</span></label
        >

        <div class="flex gap-2">
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
            <svg
              (click)="setRating(star)"
              (mouseenter)="hoveredStar = star"
              (mouseleave)="hoveredStar = 0"
              class="w-8 h-8 cursor-pointer transition-transform hover:scale-110"
              [class.text-yellow-400]="star <= (hoveredStar || rating.value)"
              [class.text-slate-400]="star > (hoveredStar || rating.value)"
              fill="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"
              />
            </svg>
          </ng-container>
        </div>
      </div>
      <div>
        <label class="block text-tertiary font-medium mb-1"> Product YouTube Url</label>
        <input
          formControlName="youtubeUrl"
          placeholder="e.g. https://www.youtube.com/watch?v=V3jRDCzFw2U"
          class="w-full rounded-lg bg-white border px-4 py-3 text-tertiary placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-sky-500 placeholder:text-sm"
        />
      </div>
      <div>
        <label class="block text-tertiary font-medium mb-1">
          Product Images <span class="text-red-500">*</span></label
        >

        <input
          #fileInput
          type="file"
          accept="image/*"
          multiple
          (change)="onImagesUpload($event)"
          class="hidden"
        />
        <button
          type="button"
          (click)="fileInput.click()"
          class="px-4 py-2 rounded-lg text-sm bg-tertiary text-slate-100 hover:bg-sky-600 hover:text-slate-100 hover:cursor-pointer transition"
        >
          Upload Images
        </button>
        <p class="text-xs text-slate-500 mt-2">
          You can upload multiple images. PNG, JPG recommended and file size should be less than 200
          Kb.
        </p>
        <div *ngIf="images().length" class="grid grid-cols-2 sm:grid-cols-3 gap-4 mt-4">
          <div *ngFor="let img of images(); let i = index" class="relative group">
            <img
              [src]="img"
              class="h-48 w-full object-contain rounded-lg border border-slate-800"
            />
            <button
              type="button"
              (click)="removeImage(i)"
              class="absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full w-6 h-6 text-xs opacity-100 group-hover:opacity-100 hover:cursor-pointer transition"
              aria-label="Remove image"
            >
              ✕
            </button>
          </div>
        </div>
      </div>

      <div class="flex justify-end">
        <button
          type="submit"
          class="bg-tertiary enabled:hover:bg-sky-600 text-slate-100 font-semibold px-5 py-3 rounded-lg ml-0 transition disabled:opacity-50 hover:cursor-pointer disabled:cursor-not-allowed w-70 max-md:w-full"
        >
          Publish Product
        </button>
      </div>
    </form>
  </div>
</section>
<app-status-modal #modal />
